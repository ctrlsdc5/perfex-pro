<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PerfEx Pro | World-Class Performance Suite</title>

<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">

<style>
body { font-family: 'Plus Jakarta Sans', sans-serif; background: #070b14; color: #f8fafc; overflow-x: hidden; }
.glass { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

const { useState, useMemo, useEffect } = React;

/* ========= SUPABASE CONFIG ========= */

const SUPABASE_URL = "YOUR_SUPABASE_URL";
const SUPABASE_KEY = "YOUR_PUBLIC_ANON_KEY";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* =================================== */

const DEPARTMENTS = ['Electrician','HVAC Operator','BMS Operator'];

function App() {

const [view,setView] = useState('login');
const [manager,setManager] = useState('');
const [activeTab,setActiveTab] = useState('rate');

const [staff] = useState([
{ id:1,name:'Arbaj Patel',dept:'Electrician'},
{ id:2,name:'Vishal Palekar',dept:'Electrician'},
{ id:3,name:'Rishabh Dhamne',dept:'HVAC Operator'},
{ id:4,name:'Anurag Singh',dept:'BMS Operator'},
{ id:5,name:'Danish Ansari',dept:'BMS Operator'}
]);

const [ratings,setRatings] = useState([]);

/* ===== LOAD FROM SUPABASE ===== */

useEffect(()=>{
loadRatings();
},[]);

async function loadRatings(){
const { data,error } = await supabase.from("ratings").select("*");
if(!error && data){
setRatings(data);
}
}

/* ===== SAVE TO SUPABASE ===== */

async function saveRating(r){

const newRating = {
...r,
date:new Date().toLocaleDateString()
};

const { error } = await supabase.from("ratings").insert([newRating]);

if(!error){
setRatings(prev=>[...prev,newRating]);
alert("Saved to database âœ…");
}else{
alert("Error saving rating");
}
}

/* ===== RANKING ===== */

const rankingData = useMemo(()=>{
return staff.map(s=>{
const staffRatings = ratings.filter(r=>r.empId===s.id);
const avg = staffRatings.length===0?0:
staffRatings.reduce((a,b)=>a+b.avg,0)/staffRatings.length;
return {...s,score:parseFloat(avg.toFixed(2))};
}).sort((a,b)=>b.score-a.score);
},[ratings,staff]);

/* ===== LOGIN UI ===== */

if(view==='login') return(
<div className="h-screen flex items-center justify-center bg-[#020617]">
<div className="p-8 glass rounded-3xl w-80 text-center">
<h1 className="text-3xl font-black text-blue-500 mb-6">PERFEX</h1>

<input type="text"
placeholder="Enter Your Name"
className="w-full p-3 bg-slate-800 rounded-xl mb-4"
onChange={(e)=>setManager(e.target.value)}
/>

<button
onClick={()=> manager ? setView('main') : alert("Enter name")}
className="w-full py-3 bg-blue-600 rounded-xl font-bold">
Start
</button>
</div>
</div>
);

/* ===== MAIN UI ===== */

return(
<div className="min-h-screen bg-[#070b14] text-white">

<header className="p-4 glass flex justify-between">
<div>Welcome {manager}</div>
<button onClick={()=>setView('login')}>Logout</button>
</header>

<main className="p-6 pb-40 max-w-md mx-auto">

{activeTab==='rate' && (
<RatingFlow staff={staff} manager={manager} onDone={saveRating}/>
)}

{activeTab==='stats' && (
<div>
{rankingData.map((s,i)=>(
<div key={s.id} className="glass p-4 rounded-2xl mb-3 flex justify-between">
<div>
<div>{s.name}</div>
<div className="text-xs text-slate-400">{s.dept}</div>
</div>
<div className="font-bold">{s.score||'---'}</div>
</div>
))}
</div>
)}

</main>

<nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-80 glass rounded-2xl p-2 flex justify-around">
<button onClick={()=>setActiveTab('rate')}>RATE</button>
<button onClick={()=>setActiveTab('stats')}>LEADERBOARD</button>
</nav>

</div>
);
}

/* ===== RATING FLOW ===== */

function RatingFlow({ staff, manager, onDone }){

const [emp,setEmp] = useState(staff[0]);
const [vals,setVals] = useState({t:5,c:5,p:5,s:5});

return(
<div className="glass p-6 rounded-2xl">

<select
className="w-full mb-4 bg-slate-800 p-2 rounded"
onChange={(e)=>setEmp(staff.find(s=>s.id==e.target.value))}
>
{staff.map(s=>(
<option key={s.id} value={s.id}>{s.name}</option>
))}
</select>

<button
onClick={()=>{
onDone({
manager,
empId:emp.id,
name:emp.name,
dept:emp.dept,
...vals,
avg:(vals.t+vals.c+vals.p+vals.s)/4
});
}}
className="w-full py-3 bg-blue-600 rounded-xl">
Confirm Rating
</button>

</div>
);
}

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);

</script>
</body>
</html>
