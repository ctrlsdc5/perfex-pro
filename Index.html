<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PerfEx Pro | World-Class Performance Suite</title>

<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">

<style>
body { font-family: 'Plus Jakarta Sans', sans-serif; background: #070b14; color: #f8fafc; overflow-x: hidden; }
.glass { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
.star-gold { color: #FFD700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
.star-gray { color: #1e293b; }
.nav-active { color: #3b82f6; position: relative; }
.nav-active::after { content: ''; position: absolute; bottom: -4px; width: 12px; height: 3px; background: #3b82f6; border-radius: 10px; }
.btn-bounce:active { transform: scale(0.95); }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

const { useState, useMemo, useEffect } = React;

const SUPABASE_URL = "https://thjeftenonekovxflzvd.supabase.co";
const SUPABASE_KEY = "PASTE_YOUR_PUBLISHABLE_KEY_HERE";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const DEPARTMENTS = ['Electrician', 'HVAC Operator', 'BMS Operator'];
const ADMIN_PASS = "Inf0rmati0n@123";

function App() {

const [view, setView] = useState('login'); 
const [manager, setManager] = useState('');
const [isAdmin, setIsAdmin] = useState(false);
const [activeTab, setActiveTab] = useState('home');
const [passInput, setPassInput] = useState('');
const [showPass, setShowPass] = useState(false);

const [staff, setStaff] = useState([
{ id: 1, name: 'Arbaj Patel', dept: 'Electrician' },
{ id: 2, name: 'Vishal Palekar', dept: 'Electrician' },
{ id: 3, name: 'Rishabh Dhamne', dept: 'HVAC Operator' },
{ id: 4, name: 'Anurag Singh', dept: 'BMS Operator' },
{ id: 5, name: 'Danish Ansari', dept: 'BMS Operator' }
]);

const [ratings, setRatings] = useState([]);
const [selectedDept, setSelectedDept] = useState('Electrician');

useEffect(() => {
loadRatings();
}, []);

async function loadRatings() {
const { data } = await supabase.from('ratings').select('*');
if (data) setRatings(data);
}

const rankingData = useMemo(() => {
return staff.map(s => {
const staffRatings = ratings.filter(r => r.empId === s.id);
const avg = staffRatings.length === 0 ? 0 :
staffRatings.reduce((a, b) => a + b.avg, 0) / staffRatings.length;
return { ...s, score: parseFloat(avg.toFixed(2)), ratedBy: staffRatings.length };
}).sort((a, b) => b.score - a.score);
}, [ratings, staff]);

const handleLogin = () => {
if (isAdmin) {
if (passInput === ADMIN_PASS) setView('main');
else alert("Wrong Admin Password!");
} else {
if (manager.trim()) setView('main');
else alert("Please enter manager name");
}
};

const handleLogout = () => {
if(confirm("Are you sure you want to logout?")) {
setView('login');
setManager('');
setPassInput('');
setIsAdmin(false);
setActiveTab('home');
}
};

const exportExcel = () => {
const data = ratings.map(r => ({
'Manager': r.manager,
'Employee': r.name,
'Category': r.dept,
'Technical': r.t,
'Teamwork': r.c,
'Punctuality': r.p,
'Critical Thinking': r.s,
'Overall Avg': r.avg.toFixed(2),
'Date': r.date
}));
const ws = XLSX.utils.json_to_sheet(data);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "Master Report");
XLSX.writeFile(wb, `PerfEx_Report_${new Date().toLocaleDateString()}.xlsx`);
};

return view === 'login' ? (
<div className="h-screen flex flex-col items-center justify-center p-6 bg-[#020617]">
<div className="w-full max-w-sm p-8 rounded-[2.5rem] glass text-center animate-slide-up shadow-2xl">
<h1 className="text-4xl font-black text-blue-500 italic">PERFEX</h1>
<input type="text" placeholder="Enter Your Name"
className="w-full mt-6 p-4 bg-slate-900 rounded-2xl text-white"
onChange={(e) => setManager(e.target.value)} />
<button onClick={handleLogin}
className="w-full mt-6 py-4 bg-blue-600 rounded-2xl font-black">
Start Assessment
</button>
</div>
</div>
) : (
<div className="p-6 max-w-md mx-auto">
<h2 className="text-xl font-bold mb-4">Welcome {manager}</h2>

{staff.map(emp => (
<div key={emp.id} className="glass p-4 mb-4 rounded-2xl">
<div className="font-bold mb-2">{emp.name}</div>
<button onClick={async ()=>{
await supabase.from('ratings').insert([{
manager,
empId: emp.id,
name: emp.name,
dept: emp.dept,
t:5,c:5,p:5,s:5,
avg:5,
date:new Date().toLocaleDateString()
}]);
loadRatings();
}}
className="bg-blue-600 px-4 py-2 rounded">
Quick 5‚≠ê Test Save
</button>
</div>
))}

<h3 className="text-lg font-bold mt-6">Leaderboard</h3>
{rankingData.map((s,i)=>(
<div key={i} className="glass p-3 mt-2 rounded flex justify-between">
<span>{s.name}</span>
<span>{s.score}</span>
</div>
))}

</div>
);
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);

</script>
</body>
</html>
