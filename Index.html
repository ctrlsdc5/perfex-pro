<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PerfEx Pro</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://thjeftenonekovxflzvd.supabase.co";
const SUPABASE_KEY = "sb_publishable_BgdiBx65Zcd-5DTTFRbrjw_lhWluEmu";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
window.supabaseClient = supabase;
</script>

</head>

<body class="bg-slate-900 text-white">
<div id="root"></div>

<script type="text/babel">

const { useState, useEffect } = React;

function App() {

  const [manager, setManager] = useState("");
  const [ratings, setRatings] = useState([]);

  useEffect(() => {
    loadRatings();
  }, []);

  async function loadRatings() {
    const { data } = await window.supabaseClient
      .from("ratings")
      .select("*");
    if (data) setRatings(data);
  }

  async function addRating() {
    if (!manager) return alert("Enter Manager Name");

    await window.supabaseClient.from("ratings").insert([{
      manager: manager,
      empId: 1,
      name: "Demo Employee",
      dept: "Electrician",
      t: 4,
      c: 4,
      p: 4,
      s: 4,
      avg: 4,
      date: new Date().toLocaleDateString()
    }]);

    loadRatings();
    alert("Saved to Cloud ✅");
  }

  return (
    <div className="p-10 space-y-6 text-center">
      <h1 className="text-3xl font-bold">PerfEx Cloud Version</h1>

      <input
        className="p-3 rounded text-black"
        placeholder="Manager Name"
        onChange={(e)=>setManager(e.target.value)}
      />

      <div>
        <button
          onClick={addRating}
          className="bg-blue-600 px-6 py-3 rounded mt-4"
        >
          Test Save Rating
        </button>
      </div>

      <div className="mt-10">
        <h2 className="text-xl mb-4">Saved Ratings</h2>
        {ratings.map((r,i)=>(
          <div key={i} className="bg-slate-800 p-3 rounded mb-2">
            {r.manager} - {r.name} - {r.avg}⭐
          </div>
        ))}
      </div>

    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);

</script>
</body>
</html>
